import{s as he,f as E,a0 as Fe,a as L,l as Y,g as y,h as V,a1 as Ze,c as z,m as F,d as _,j as p,M as R,i as j,z as b,n as ae,r as Q,P as ge,Q as ve,e as X,U as We,y as _e,o as xe,p as ke,F as ce,G as O,J as fe,k as de,x as ue,O as ne}from"../chunks/scheduler.2vmdsppc.js";import{S as me,i as pe,b as x,d as ee,m as le,a as D,t as C,c as q,e as te,g as J}from"../chunks/index.eLAHt3dB.js";import{Z as we,y as el,P as ll,p as Ee,Q as tl,z as ye,b as rl,e as re}from"../chunks/utils.FkBaGfnY.js";import{p as sl}from"../chunks/stores._GSMfgpH.js";import{n as Z}from"../chunks/VerificationMark.95_-Gkx8.js";import{p as se}from"../chunks/profile_picture_placeholder.0d-yZyxG.js";import{S as Ue}from"../chunks/SendMessage.U2vh_8ek.js";import{T as Xe}from"../chunks/Title-h1.ksZwEtxJ.js";import{N as be}from"../chunks/Nip05Checkmark.WfrkC49G.js";const al=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function nl(s){let e,t,l,r=s[0].message+"",n,a,d=we(s[0].created_at)+"",i;return{c(){e=E("div"),t=E("div"),l=new Fe(!1),n=L(),a=E("div"),i=Y(d),this.h()},l(o){e=y(o,"DIV",{class:!0});var c=V(e);t=y(c,"DIV",{class:!0});var m=V(t);l=Ze(m,!1),n=z(m),a=y(m,"DIV",{class:!0});var g=V(a);i=F(g,d),g.forEach(_),m.forEach(_),c.forEach(_),this.h()},h(){l.a=n,p(a,"class","space-y-1 text-xs opacity-60 text-right mt-1"),p(t,"class","chat-bubble max-w-[80%] lg:max-w-[60%] text-white"),R(t,"chat-bubble-primary",!s[0].my_message_replying_to_this_pubkey),R(t,"chat-bubble-accent",s[0].my_message_replying_to_this_pubkey),p(e,"class","chat mt-0 md:mt-4"),R(e,"chat-start",!s[0].my_message_replying_to_this_pubkey),R(e,"chat-end",s[0].my_message_replying_to_this_pubkey)},m(o,c){j(o,e,c),b(e,t),l.m(r,t),b(t,n),b(t,a),b(a,i)},p(o,[c]){c&1&&r!==(r=o[0].message+"")&&l.p(r),c&1&&d!==(d=we(o[0].created_at)+"")&&ae(i,d),c&1&&R(t,"chat-bubble-primary",!o[0].my_message_replying_to_this_pubkey),c&1&&R(t,"chat-bubble-accent",o[0].my_message_replying_to_this_pubkey),c&1&&R(e,"chat-start",!o[0].my_message_replying_to_this_pubkey),c&1&&R(e,"chat-end",o[0].my_message_replying_to_this_pubkey)},i:Q,o:Q,d(o){o&&_(e)}}}function il(s,e,t){let{message:l}=e;return s.$$set=r=>{"message"in r&&t(0,l=r.message)},[l]}class Ye extends me{constructor(e){super(),pe(this,e,il,nl,he,{message:0})}}function ol(s){let e,t;return{c(){e=ge("svg"),t=ge("path"),this.h()},l(l){e=ve(l,"svg",{xmlns:!0,fill:!0,viewBox:!0,"stroke-width":!0,stroke:!0});var r=V(e);t=ve(r,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,d:!0}),V(t).forEach(_),r.forEach(_),this.h()},h(){p(t,"stroke-linecap","round"),p(t,"stroke-linejoin","round"),p(t,"d","M6.75 15.75L3 12m0 0l3.75-3.75M3 12h18"),p(e,"xmlns","http://www.w3.org/2000/svg"),p(e,"fill","none"),p(e,"viewBox","0 0 24 24"),p(e,"stroke-width","1.5"),p(e,"stroke","currentColor")},m(l,r){j(l,e,r),b(e,t)},p:Q,i:Q,o:Q,d(l){l&&_(e)}}}class cl extends me{constructor(e){super(),pe(this,e,null,ol,he,{})}}const{document:$e}=al;function Ie(s,e,t){const l=s.slice();return l[31]=e[t][0],l[32]=e[t][1],l}function Ve(s,e,t){const l=s.slice();return l[35]=e[t][0],l[28]=e[t][1],l}function De(s,e,t){const l=s.slice();return l[27]=e[t][0],l[28]=e[t][1],l}function Me(s,e,t){const l=s.slice();return l[27]=e[t][0],l[32]=e[t][1],l}function Pe(s,e,t){const l=s.slice();return l[27]=e[t][0],l[28]=e[t][1],l}function fl(s){let e;return{c(){e=Y("Private Messages")},l(t){e=F(t,"Private Messages")},m(t,l){j(t,e,l)},d(t){t&&_(e)}}}function Ne(s){let e,t,l;return t=new Xe({props:{$$slots:{default:[ul]},$$scope:{ctx:s}}}),{c(){e=E("div"),x(t.$$.fragment),this.h()},l(r){e=y(r,"DIV",{class:!0});var n=V(e);ee(t.$$.fragment,n),n.forEach(_),this.h()},h(){p(e,"class","block md:hidden")},m(r,n){j(r,e,n),le(t,e,null),l=!0},i(r){l||(D(t.$$.fragment,r),l=!0)},o(r){C(t.$$.fragment,r),l=!1},d(r){r&&_(e),te(t)}}}function ul(s){let e;return{c(){e=Y("Private Messages")},l(t){e=F(t,"Private Messages")},m(t,l){j(t,e,l)},d(t){t&&_(e)}}}function dl(s){let e,t,l="You have to login to see your messages.",r,n,a="Login",d,i;return{c(){e=E("div"),t=E("p"),t.textContent=l,r=L(),n=E("button"),n.textContent=a,this.h()},l(o){e=y(o,"DIV",{class:!0});var c=V(e);t=y(c,"P",{"data-svelte-h":!0}),ce(t)!=="svelte-pft54i"&&(t.textContent=l),r=z(c),n=y(c,"BUTTON",{class:!0,"data-svelte-h":!0}),ce(n)!=="svelte-17byqmd"&&(n.textContent=a),c.forEach(_),this.h()},h(){p(n,"class","btn btn-info mt-4 justify-center"),p(e,"class","p-4 justify-center")},m(o,c){j(o,e,c),b(e,t),b(e,r),b(e,n),d||(i=[O(n,"click",s[24]),O(n,"keypress",s[25])],d=!0)},p:Q,i:Q,o:Q,d(o){o&&_(e),d=!1,fe(i)}}}function _l(s){let e,t,l,r;const n=[ml,hl],a=[];function d(i,o){return i[7]||i[3].length>0?0:1}return e=d(s),t=a[e]=n[e](s),{c(){t.c(),l=X()},l(i){t.l(i),l=X()},m(i,o){a[e].m(i,o),j(i,l,o),r=!0},p(i,o){let c=e;e=d(i),e===c?a[e].p(i,o):(J(),C(a[c],1,1,()=>{a[c]=null}),q(),t=a[e],t?t.p(i,o):(t=a[e]=n[e](i),t.c()),D(t,1),t.m(l.parentNode,l))},i(i){r||(D(t),r=!0)},o(i){C(t),r=!1},d(i){i&&_(l),a[e].d(i)}}}function hl(s){let e,t="<p>You don&#39;t have any message yet.</p>";return{c(){e=E("div"),e.innerHTML=t,this.h()},l(l){e=y(l,"DIV",{class:!0,"data-svelte-h":!0}),ce(e)!=="svelte-ozuil"&&(e.innerHTML=t),this.h()},h(){p(e,"class","p-4 justify-center")},m(l,r){j(l,e,r)},p:Q,i:Q,o:Q,d(l){l&&_(e)}}}function ml(s){let e,t,l,r,n,a,d,i,o,c,m,g,I,u,f=s[7]&&!s[2].human[s[7]]&&Te(s),k=re(s[3]),h=[];for(let w=0;w<k.length;w+=1)h[w]=je(Pe(s,k,w));const M=w=>C(h[w],1,1,()=>{h[w]=null}),H=[bl,pl],T=[];function P(w,v){return w[1]?0:1}i=P(s),o=T[i]=H[i](s);const B=[vl,gl],K=[];function S(w,v){return w[1]?1:0}return m=S(s),g=K[m]=B[m](s),{c(){e=E("div"),t=E("div"),f&&f.c(),l=L();for(let w=0;w<h.length;w+=1)h[w].c();r=L(),n=E("div"),a=L(),d=E("div"),o.c(),c=L(),g.c(),I=X(),this.h()},l(w){e=y(w,"DIV",{class:!0});var v=V(e);t=y(v,"DIV",{class:!0});var A=V(t);f&&f.l(A),l=z(A);for(let N=0;N<h.length;N+=1)h[N].l(A);A.forEach(_),r=z(v),n=y(v,"DIV",{class:!0}),V(n).forEach(_),a=z(v),d=y(v,"DIV",{class:!0,id:!0,style:!0});var G=V(d);o.l(G),G.forEach(_),v.forEach(_),c=z(w),g.l(w),I=X(),this.h()},h(){p(t,"class","block w-1/3 p-1 menu card h-auto max-h-full gap-2 rounded-box bg-cover bg-top bg-base-300 bg-info-content-200 overflow-y-auto overflow-x-hidden scrollbar:!w-1.5 scrollbar:!h-1.5 scrollbar:bg-transparent scrollbar-track:!bg-slate-100 scrollbar-thumb:!rounded scrollbar-thumb:!bg-slate-300 scrollbar-track:!rounded dark:scrollbar-track:!bg-slate-500/[0.16] dark:scrollbar-thumb:!bg-slate-500/50 hover:scrollbar-thumb:!bg-slate-400/80 lg:supports-scrollbars:pr-2"),p(n,"class","divider lg:divider-horizontal"),p(d,"class","flex flex-col flex-grow w-full p-4 gap-2 card bg-base-300 rounded-box bg-cover bg-top bg-info-content-200 overflow-x-hidden overflow-y-auto scrollbar:!w-1.5 scrollbar:!h-1.5 scrollbar:bg-transparent scrollbar-track:!bg-slate-100 scrollbar-thumb:!rounded scrollbar-thumb:!bg-slate-300 scrollbar-track:!rounded dark:scrollbar-track:!bg-slate-500/[0.16] dark:scrollbar-thumb:!bg-slate-500/50 lg:supports-scrollbars:pr-2 hover:scrollbar-thumb:!bg-slate-400/80"),p(d,"id","conversationMessagesDesktop"),de(d,"background-size","5px 5px"),de(d,"background-image","radial-gradient(hsla(var(--bc)/.2) 0.5px,hsla(var(--b2)/1) 0.5px)"),p(e,"class","hidden lg:flex h-[46rem]")},m(w,v){j(w,e,v),b(e,t),f&&f.m(t,null),b(t,l);for(let A=0;A<h.length;A+=1)h[A]&&h[A].m(t,null);b(e,r),b(e,n),b(e,a),b(e,d),T[i].m(d,null),j(w,c,v),K[m].m(w,v),j(w,I,v),u=!0},p(w,v){if(w[7]&&!w[2].human[w[7]]?f?f.p(w,v):(f=Te(w),f.c(),f.m(t,l)):f&&(f.d(1),f=null),v[0]&2059){k=re(w[3]);let N;for(N=0;N<k.length;N+=1){const $=Pe(w,k,N);h[N]?(h[N].p($,v),D(h[N],1)):(h[N]=je($),h[N].c(),D(h[N],1),h[N].m(t,null))}for(J(),N=k.length;N<h.length;N+=1)M(N);q()}let A=i;i=P(w),i===A?T[i].p(w,v):(J(),C(T[A],1,1,()=>{T[A]=null}),q(),o=T[i],o?o.p(w,v):(o=T[i]=H[i](w),o.c()),D(o,1),o.m(d,null));let G=m;m=S(w),m===G?K[m].p(w,v):(J(),C(K[G],1,1,()=>{K[G]=null}),q(),g=K[m],g?g.p(w,v):(g=K[m]=B[m](w),g.c()),D(g,1),g.m(I.parentNode,I))},i(w){if(!u){for(let v=0;v<k.length;v+=1)D(h[v]);D(o),D(g),u=!0}},o(w){h=h.filter(Boolean);for(let v=0;v<h.length;v+=1)C(h[v]);C(o),C(g),u=!1},d(w){w&&(_(e),_(c),_(I)),f&&f.d(),ue(h,w),T[i].d(),K[m].d(w)}}}function Te(s){let e,t,l,r,n,a,d,i,o,c=Z.npubEncode(s[7])+"",m,g,I;return{c(){e=E("li"),t=E("div"),l=E("div"),r=E("div"),n=E("img"),d=L(),i=E("div"),o=Y("New conversation: "),m=Y(c),this.h()},l(u){e=y(u,"LI",{class:!0});var f=V(e);t=y(f,"DIV",{class:!0});var k=V(t);l=y(k,"DIV",{class:!0});var h=V(l);r=y(h,"DIV",{class:!0});var M=V(r);n=y(M,"IMG",{src:!0}),M.forEach(_),h.forEach(_),d=z(k),i=y(k,"DIV",{class:!0});var H=V(i);o=F(H,"New conversation: "),m=F(H,c),H.forEach(_),k.forEach(_),f.forEach(_),this.h()},h(){ne(n.src,a=se)||p(n,"src",a),p(r,"class","w-16 rounded-full"),p(l,"class","avatar indicator"),p(i,"class","truncate"),p(t,"class","w-full"),p(e,"class","rounded-lg w-full"),R(e,"bg-accent",s[1]===s[7])},m(u,f){j(u,e,f),b(e,t),b(t,l),b(l,r),b(r,n),b(t,d),b(t,i),b(i,o),b(i,m),g||(I=[O(n,"error",s[12]),O(e,"click",s[13])],g=!0)},p(u,f){f[0]&128&&c!==(c=Z.npubEncode(u[7])+"")&&ae(m,c),f[0]&130&&R(e,"bg-accent",u[1]===u[7])},d(u){u&&_(e),g=!1,fe(I)}}}function Ce(s){let e,t=s[28].unreadMessages+"",l;return{c(){e=E("span"),l=Y(t),this.h()},l(r){e=y(r,"SPAN",{class:!0});var n=V(e);l=F(n,t),n.forEach(_),this.h()},h(){p(e,"class","indicator-item badge badge-sm badge-error")},m(r,n){j(r,e,n),b(e,l)},p(r,n){n[0]&8&&t!==(t=r[28].unreadMessages+"")&&ae(l,t)},d(r){r&&_(e)}}}function Ae(s){let e,t,l;return t=new be({props:{address:s[28].nip05VerifiedAddress,verificationMarkSize:"5"}}),{c(){e=E("span"),x(t.$$.fragment),this.h()},l(r){e=y(r,"SPAN",{class:!0});var n=V(e);ee(t.$$.fragment,n),n.forEach(_),this.h()},h(){p(e,"class","ml-2 mt-1")},m(r,n){j(r,e,n),le(t,e,null),l=!0},p(r,n){const a={};n[0]&8&&(a.address=r[28].nip05VerifiedAddress),t.$set(a)},i(r){l||(D(t.$$.fragment,r),l=!0)},o(r){C(t.$$.fragment,r),l=!1},d(r){r&&_(e),te(t)}}}function Se(s){let e,t="Received on the stall";return{c(){e=E("span"),e.textContent=t,this.h()},l(l){e=y(l,"SPAN",{class:!0,"data-svelte-h":!0}),ce(e)!=="svelte-17ai8nq"&&(e.textContent=t),this.h()},h(){p(e,"class","indicator-item badge badge-sm badge-info")},m(l,r){j(l,e,r)},d(l){l&&_(e)}}}function je(s){let e,t,l,r,n,a,d,i,o,c,m=(s[28].name??Z.npubEncode(s[27]))+"",g,I,u,f,k,h,M,H,T=s[28].unreadMessages&&Ce(s),P=s[28].nip05VerifiedAddress&&Ae(s),B=s[28]&&s[28].merchantPrivateKey&&Se();function K(){return s[15](s[27])}return{c(){e=E("li"),t=E("div"),l=E("div"),T&&T.c(),r=L(),n=E("div"),a=E("img"),i=L(),o=E("div"),c=E("span"),g=Y(m),I=L(),P&&P.c(),u=L(),f=E("div"),B&&B.c(),k=L(),this.h()},l(S){e=y(S,"LI",{class:!0});var w=V(e);t=y(w,"DIV",{class:!0});var v=V(t);l=y(v,"DIV",{class:!0});var A=V(l);T&&T.l(A),r=z(A),n=y(A,"DIV",{class:!0});var G=V(n);a=y(G,"IMG",{src:!0}),G.forEach(_),A.forEach(_),i=z(v),o=y(v,"DIV",{class:!0});var N=V(o);c=y(N,"SPAN",{class:!0});var $=V(c);g=F($,m),$.forEach(_),I=z(N),P&&P.l(N),N.forEach(_),u=z(v),f=y(v,"DIV",{});var U=V(f);B&&B.l(U),U.forEach(_),v.forEach(_),k=z(w),w.forEach(_),this.h()},h(){ne(a.src,d=s[28].picture??se)||p(a,"src",d),p(n,"class","w-16 rounded-full"),p(l,"class","avatar indicator"),p(c,"class","text-lg truncate"),p(o,"class","flex ml-1"),p(t,"class","w-full"),p(e,"class","rounded-lg w-full"),R(e,"bg-accent",s[1]===s[27]),R(e,"text-black",s[1]===s[27])},m(S,w){j(S,e,w),b(e,t),b(t,l),T&&T.m(l,null),b(l,r),b(l,n),b(n,a),b(t,i),b(t,o),b(o,c),b(c,g),b(o,I),P&&P.m(o,null),b(t,u),b(t,f),B&&B.m(f,null),b(e,k),h=!0,M||(H=[O(a,"error",s[14]),O(e,"click",K)],M=!0)},p(S,w){s=S,s[28].unreadMessages?T?T.p(s,w):(T=Ce(s),T.c(),T.m(l,r)):T&&(T.d(1),T=null),(!h||w[0]&8&&!ne(a.src,d=s[28].picture??se))&&p(a,"src",d),(!h||w[0]&8)&&m!==(m=(s[28].name??Z.npubEncode(s[27]))+"")&&ae(g,m),s[28].nip05VerifiedAddress?P?(P.p(s,w),w[0]&8&&D(P,1)):(P=Ae(s),P.c(),D(P,1),P.m(o,null)):P&&(J(),C(P,1,1,()=>{P=null}),q()),s[28]&&s[28].merchantPrivateKey?B||(B=Se(),B.c(),B.m(f,null)):B&&(B.d(1),B=null),(!h||w[0]&10)&&R(e,"bg-accent",s[1]===s[27]),(!h||w[0]&10)&&R(e,"text-black",s[1]===s[27])},i(S){h||(D(P),h=!0)},o(S){C(P),h=!1},d(S){S&&_(e),T&&T.d(),P&&P.d(),B&&B.d(),M=!1,fe(H)}}}function pl(s){let e,t="Choose a conversation to see the messages.";return{c(){e=E("p"),e.textContent=t,this.h()},l(l){e=y(l,"P",{class:!0,"data-svelte-h":!0}),ce(e)!=="svelte-1uhkglh"&&(e.textContent=t),this.h()},h(){p(e,"class","m-6")},m(l,r){j(l,e,r)},p:Q,i:Q,o:Q,d(l){l&&_(e)}}}function bl(s){let e,t,l,r,n,a,d,i,o,c,m,g=re(s[4]),I=[];for(let f=0;f<g.length;f+=1)I[f]=ze(Me(s,g,f));const u=f=>C(I[f],1,1,()=>{I[f]=null});return i=new Ue({}),{c(){for(let f=0;f<I.length;f+=1)I[f].c();e=L(),t=E("div"),l=E("div"),r=E("textarea"),n=L(),a=E("div"),d=E("div"),x(i.$$.fragment),this.h()},l(f){for(let T=0;T<I.length;T+=1)I[T].l(f);e=z(f),t=y(f,"DIV",{class:!0});var k=V(t);l=y(k,"DIV",{class:!0});var h=V(l);r=y(h,"TEXTAREA",{rows:!0,placeholder:!0,class:!0}),V(r).forEach(_),n=z(h),a=y(h,"DIV",{class:!0});var M=V(a);d=y(M,"DIV",{class:!0});var H=V(d);ee(i.$$.fragment,H),H.forEach(_),M.forEach(_),h.forEach(_),k.forEach(_),this.h()},h(){p(r,"rows","1"),r.autofocus=!0,p(r,"placeholder","Type your message"),p(r,"class","p-2 w-full bg-medium placeholder:text-light outline-0 resize-none"),p(d,"class","w-7 h-7"),p(a,"class","p-4 flex justify-center hover:scale-110 duration-300 transition-all cursor-pointer text-black dark:text-white"),p(l,"class","flex col-span-2"),p(t,"class","grid grid-cols-2 w-screen lg:w-2/3 p-3 bg-gray-300 dark:bg-black rounded-lg items-center inset-x-0 bottom-0 mx-auto mt-auto")},m(f,k){for(let h=0;h<I.length;h+=1)I[h]&&I[h].m(f,k);j(f,e,k),j(f,t,k),b(t,l),b(l,r),s[16](r),b(l,n),b(l,a),b(a,d),le(i,d,null),o=!0,r.focus(),c||(m=[O(r,"keypress",s[9]),O(a,"click",s[10]),O(a,"keypress",s[9])],c=!0)},p(f,k){if(k[0]&16){g=re(f[4]);let h;for(h=0;h<g.length;h+=1){const M=Me(f,g,h);I[h]?(I[h].p(M,k),D(I[h],1)):(I[h]=ze(M),I[h].c(),D(I[h],1),I[h].m(e.parentNode,e))}for(J(),h=g.length;h<I.length;h+=1)u(h);q()}},i(f){if(!o){for(let k=0;k<g.length;k+=1)D(I[k]);D(i.$$.fragment,f),o=!0}},o(f){I=I.filter(Boolean);for(let k=0;k<I.length;k+=1)C(I[k]);C(i.$$.fragment,f),o=!1},d(f){f&&(_(e),_(t)),ue(I,f),s[16](null),te(i),c=!1,fe(m)}}}function Le(s){let e,t;return e=new Ye({props:{message:s[32]}}),{c(){x(e.$$.fragment)},l(l){ee(e.$$.fragment,l)},m(l,r){le(e,l,r),t=!0},p(l,r){const n={};r[0]&16&&(n.message=l[32]),e.$set(n)},i(l){t||(D(e.$$.fragment,l),t=!0)},o(l){C(e.$$.fragment,l),t=!1},d(l){te(e,l)}}}function ze(s){let e,t,l=typeof s[32]=="object"&&Le(s);return{c(){l&&l.c(),e=X()},l(r){l&&l.l(r),e=X()},m(r,n){l&&l.m(r,n),j(r,e,n),t=!0},p(r,n){typeof r[32]=="object"?l?(l.p(r,n),n[0]&16&&D(l,1)):(l=Le(r),l.c(),D(l,1),l.m(e.parentNode,e)):l&&(J(),C(l,1,1,()=>{l=null}),q())},i(r){t||(D(l),t=!0)},o(r){C(l),t=!1},d(r){r&&_(e),l&&l.d(r)}}}function gl(s){let e,t,l,r,n,a,d,i,o,c,m,g,I,u,f,k,h,M,H;l=new cl({});const T=[wl,kl],P=[];function B(v,A){return v[7]&&!v[2].human[v[7]]?0:1}n=B(s),a=P[n]=T[n](s);let K=re(s[4]),S=[];for(let v=0;v<K.length;v+=1)S[v]=Oe(Ie(s,K,v));const w=v=>C(S[v],1,1,()=>{S[v]=null});return k=new Ue({}),{c(){e=E("div"),t=E("div"),x(l.$$.fragment),r=L(),a.c(),d=L(),i=E("div"),o=E("div");for(let v=0;v<S.length;v+=1)S[v].c();c=L(),m=E("div"),g=E("textarea"),I=L(),u=E("div"),f=E("div"),x(k.$$.fragment),this.h()},l(v){e=y(v,"DIV",{class:!0});var A=V(e);t=y(A,"DIV",{class:!0});var G=V(t);ee(l.$$.fragment,G),G.forEach(_),r=z(A),a.l(A),A.forEach(_),d=z(v),i=y(v,"DIV",{class:!0,id:!0,style:!0});var N=V(i);o=y(N,"DIV",{class:!0});var $=V(o);for(let oe=0;oe<S.length;oe+=1)S[oe].l($);$.forEach(_),c=z(N),m=y(N,"DIV",{class:!0});var U=V(m);g=y(U,"TEXTAREA",{rows:!0,placeholder:!0,class:!0}),V(g).forEach(_),I=z(U),u=y(U,"DIV",{class:!0});var W=V(u);f=y(W,"DIV",{class:!0});var ie=V(f);ee(k.$$.fragment,ie),ie.forEach(_),W.forEach(_),U.forEach(_),N.forEach(_),this.h()},h(){p(t,"class","w-10 mr-4 mt-1 cursor-pointer"),p(e,"class","lg:hidden flex w-full mx-auto pt-6 pb-1 leading-none"),p(o,"class","mt-2 ml-1"),p(g,"rows","1"),g.autofocus=!0,p(g,"placeholder","Type your message"),p(g,"class","p-2 w-full bg-medium placeholder:text-light outline-0 resize-none"),p(f,"class","w-6 h-6"),p(u,"class","p-4 flex justify-center hover:scale-110 duration-300 transition-all cursor-pointer text-white"),p(m,"class","flex w-full mx-auto p-3 bg-black rounded-lg items-center bottom-0 content-end col-span-2 mt-auto"),p(i,"class","lg:hidden flex h-full gap-2 card bg-base-300 rounded-box bg-cover bg-top bg-info-content-200 overflow-x-hidden overflow-y-auto scrollbar:!w-1.5 scrollbar:!h-1.5 scrollbar:bg-transparent scrollbar-track:!bg-slate-100 scrollbar-thumb:!rounded scrollbar-thumb:!bg-slate-300 scrollbar-track:!rounded dark:scrollbar-track:!bg-slate-500/[0.16] dark:scrollbar-thumb:!bg-slate-500/50 hover:scrollbar-thumb:!bg-slate-400/80"),p(i,"id","conversationMessagesMobile"),de(i,"background-size","5px 5px"),de(i,"background-image","radial-gradient(hsla(var(--bc)/.2) 0.5px,hsla(var(--b2)/1) 0.5px)")},m(v,A){j(v,e,A),b(e,t),le(l,t,null),b(e,r),P[n].m(e,null),j(v,d,A),j(v,i,A),b(i,o);for(let G=0;G<S.length;G+=1)S[G]&&S[G].m(o,null);b(i,c),b(i,m),b(m,g),s[23](g),b(m,I),b(m,u),b(u,f),le(k,f,null),h=!0,g.focus(),M||(H=[O(t,"click",s[21]),O(g,"keypress",s[9]),O(u,"click",s[10]),O(u,"keypress",s[9])],M=!0)},p(v,A){let G=n;if(n=B(v),n===G?P[n].p(v,A):(J(),C(P[G],1,1,()=>{P[G]=null}),q(),a=P[n],a?a.p(v,A):(a=P[n]=T[n](v),a.c()),D(a,1),a.m(e,null)),A[0]&16){K=re(v[4]);let N;for(N=0;N<K.length;N+=1){const $=Ie(v,K,N);S[N]?(S[N].p($,A),D(S[N],1)):(S[N]=Oe($),S[N].c(),D(S[N],1),S[N].m(o,null))}for(J(),N=K.length;N<S.length;N+=1)w(N);q()}},i(v){if(!h){D(l.$$.fragment,v),D(a);for(let A=0;A<K.length;A+=1)D(S[A]);D(k.$$.fragment,v),h=!0}},o(v){C(l.$$.fragment,v),C(a),S=S.filter(Boolean);for(let A=0;A<S.length;A+=1)C(S[A]);C(k.$$.fragment,v),h=!1},d(v){v&&(_(e),_(d),_(i)),te(l),P[n].d(),ue(S,v),s[23](null),te(k),M=!1,fe(H)}}}function vl(s){let e,t,l,r=s[7]&&!s[2].human[s[7]]&&qe(s),n=re(s[3]),a=[];for(let i=0;i<n.length;i+=1)a[i]=Qe(De(s,n,i));const d=i=>C(a[i],1,1,()=>{a[i]=null});return{c(){e=E("div"),r&&r.c(),t=L();for(let i=0;i<a.length;i+=1)a[i].c();this.h()},l(i){e=y(i,"DIV",{class:!0});var o=V(e);r&&r.l(o),t=z(o);for(let c=0;c<a.length;c+=1)a[c].l(o);o.forEach(_),this.h()},h(){p(e,"class","lg:hidden flex-grow flex-nowrap menu card w-full gap-2 p-1 -mt-6 max-h-full rounded-box bg-cover bg-top bg-base-300 bg-info-content-200 overflow-y-auto overflow-x-hidden scrollbar:!w-1.5 scrollbar:!h-1.5 scrollbar:bg-transparent scrollbar-track:!bg-slate-100 scrollbar-thumb:!rounded scrollbar-thumb:!bg-slate-300 scrollbar-track:!rounded dark:scrollbar-track:!bg-slate-500/[0.16] dark:scrollbar-thumb:!bg-slate-500/50 hover:scrollbar-thumb:!bg-slate-400/80")},m(i,o){j(i,e,o),r&&r.m(e,null),b(e,t);for(let c=0;c<a.length;c+=1)a[c]&&a[c].m(e,null);l=!0},p(i,o){if(i[7]&&!i[2].human[i[7]]?r?r.p(i,o):(r=qe(i),r.c(),r.m(e,t)):r&&(r.d(1),r=null),o[0]&2059){n=re(i[3]);let c;for(c=0;c<n.length;c+=1){const m=De(i,n,c);a[c]?(a[c].p(m,o),D(a[c],1)):(a[c]=Qe(m),a[c].c(),D(a[c],1),a[c].m(e,null))}for(J(),c=n.length;c<a.length;c+=1)d(c);q()}},i(i){if(!l){for(let o=0;o<n.length;o+=1)D(a[o]);l=!0}},o(i){a=a.filter(Boolean);for(let o=0;o<a.length;o+=1)C(a[o]);l=!1},d(i){i&&_(e),r&&r.d(),ue(a,i)}}}function kl(s){let e,t,l=re(s[3]),r=[];for(let a=0;a<l.length;a+=1)r[a]=He(Ve(s,l,a));const n=a=>C(r[a],1,1,()=>{r[a]=null});return{c(){for(let a=0;a<r.length;a+=1)r[a].c();e=X()},l(a){for(let d=0;d<r.length;d+=1)r[d].l(a);e=X()},m(a,d){for(let i=0;i<r.length;i+=1)r[i]&&r[i].m(a,d);j(a,e,d),t=!0},p(a,d){if(d[0]&11){l=re(a[3]);let i;for(i=0;i<l.length;i+=1){const o=Ve(a,l,i);r[i]?(r[i].p(o,d),D(r[i],1)):(r[i]=He(o),r[i].c(),D(r[i],1),r[i].m(e.parentNode,e))}for(J(),i=l.length;i<r.length;i+=1)n(i);q()}},i(a){if(!t){for(let d=0;d<l.length;d+=1)D(r[d]);t=!0}},o(a){r=r.filter(Boolean);for(let d=0;d<r.length;d+=1)C(r[d]);t=!1},d(a){a&&_(e),ue(r,a)}}}function wl(s){let e,t=`<div class="w-12 h-12 mr-3 rounded-full"><img src="${se}"/></div>`,l,r,n,a="New conversation:",d,i,o=Z.npubEncode(s[7])+"",c;return{c(){e=E("div"),e.innerHTML=t,l=L(),r=E("div"),n=E("p"),n.textContent=a,d=L(),i=E("p"),c=Y(o),this.h()},l(m){e=y(m,"DIV",{class:!0,"data-svelte-h":!0}),ce(e)!=="svelte-1n7mjk1"&&(e.innerHTML=t),l=z(m),r=y(m,"DIV",{class:!0});var g=V(r);n=y(g,"P",{"data-svelte-h":!0}),ce(n)!=="svelte-yc30ip"&&(n.textContent=a),d=z(g),i=y(g,"P",{});var I=V(i);c=F(I,o),I.forEach(_),g.forEach(_),this.h()},h(){p(e,"class","avatar indicator"),p(r,"class","text-base truncate")},m(m,g){j(m,e,g),j(m,l,g),j(m,r,g),b(r,n),b(r,d),b(r,i),b(i,c)},p(m,g){g[0]&128&&o!==(o=Z.npubEncode(m[7])+"")&&ae(c,o)},i:Q,o:Q,d(m){m&&(_(e),_(l),_(r))}}}function Be(s){let e,t,l,r,n,a,d=(s[28].name??Z.npubEncode(s[1]))+"",i,o,c,m,g,I,u=s[28].nip05VerifiedAddress&&Ke(s);return{c(){e=E("div"),t=E("div"),l=E("img"),n=L(),a=E("div"),i=Y(d),o=L(),u&&u.c(),c=L(),this.h()},l(f){e=y(f,"DIV",{class:!0});var k=V(e);t=y(k,"DIV",{class:!0});var h=V(t);l=y(h,"IMG",{src:!0}),h.forEach(_),k.forEach(_),n=z(f),a=y(f,"DIV",{class:!0});var M=V(a);i=F(M,d),o=z(M),u&&u.l(M),c=z(M),M.forEach(_),this.h()},h(){ne(l.src,r=s[28].picture??se)||p(l,"src",r),p(t,"class","w-12 h-12 mr-3 rounded-full"),p(e,"class","avatar indicator align-bottom"),p(a,"class","flex flex-grow w-0 mt-2 text-xl overflow-x-clip overflow-y-visible")},m(f,k){j(f,e,k),b(e,t),b(t,l),j(f,n,k),j(f,a,k),b(a,i),b(a,o),u&&u.m(a,null),b(a,c),m=!0,g||(I=O(l,"error",s[22]),g=!0)},p(f,k){(!m||k[0]&8&&!ne(l.src,r=f[28].picture??se))&&p(l,"src",r),(!m||k[0]&10)&&d!==(d=(f[28].name??Z.npubEncode(f[1]))+"")&&ae(i,d),f[28].nip05VerifiedAddress?u?(u.p(f,k),k[0]&8&&D(u,1)):(u=Ke(f),u.c(),D(u,1),u.m(a,c)):u&&(J(),C(u,1,1,()=>{u=null}),q())},i(f){m||(D(u),m=!0)},o(f){C(u),m=!1},d(f){f&&(_(e),_(n),_(a)),u&&u.d(),g=!1,I()}}}function Ke(s){let e,t,l;return t=new be({props:{address:s[28].nip05VerifiedAddress,verificationMarkSize:"6"}}),{c(){e=E("span"),x(t.$$.fragment),this.h()},l(r){e=y(r,"SPAN",{class:!0});var n=V(e);ee(t.$$.fragment,n),n.forEach(_),this.h()},h(){p(e,"class","ml-2 mt-0")},m(r,n){j(r,e,n),le(t,e,null),l=!0},p(r,n){const a={};n[0]&8&&(a.address=r[28].nip05VerifiedAddress),t.$set(a)},i(r){l||(D(t.$$.fragment,r),l=!0)},o(r){C(t.$$.fragment,r),l=!1},d(r){r&&_(e),te(t)}}}function He(s){let e,t,l=s[1]===s[35]&&Be(s);return{c(){l&&l.c(),e=X()},l(r){l&&l.l(r),e=X()},m(r,n){l&&l.m(r,n),j(r,e,n),t=!0},p(r,n){r[1]===r[35]?l?(l.p(r,n),n[0]&10&&D(l,1)):(l=Be(r),l.c(),D(l,1),l.m(e.parentNode,e)):l&&(J(),C(l,1,1,()=>{l=null}),q())},i(r){t||(D(l),t=!0)},o(r){C(l),t=!1},d(r){r&&_(e),l&&l.d(r)}}}function Ge(s){let e,t;return e=new Ye({props:{message:s[32]}}),{c(){x(e.$$.fragment)},l(l){ee(e.$$.fragment,l)},m(l,r){le(e,l,r),t=!0},p(l,r){const n={};r[0]&16&&(n.message=l[32]),e.$set(n)},i(l){t||(D(e.$$.fragment,l),t=!0)},o(l){C(e.$$.fragment,l),t=!1},d(l){te(e,l)}}}function Oe(s){let e,t,l=typeof s[32]=="object"&&Ge(s);return{c(){l&&l.c(),e=X()},l(r){l&&l.l(r),e=X()},m(r,n){l&&l.m(r,n),j(r,e,n),t=!0},p(r,n){typeof r[32]=="object"?l?(l.p(r,n),n[0]&16&&D(l,1)):(l=Ge(r),l.c(),D(l,1),l.m(e.parentNode,e)):l&&(J(),C(l,1,1,()=>{l=null}),q())},i(r){t||(D(l),t=!0)},o(r){C(l),t=!1},d(r){r&&_(e),l&&l.d(r)}}}function qe(s){let e,t,l,r,n,a,d,i,o,c=Z.npubEncode(s[7])+"",m,g,I;return{c(){e=E("li"),t=E("div"),l=E("div"),r=E("div"),n=E("img"),d=L(),i=E("div"),o=Y("New conversation: "),m=Y(c),this.h()},l(u){e=y(u,"LI",{class:!0});var f=V(e);t=y(f,"DIV",{class:!0});var k=V(t);l=y(k,"DIV",{class:!0});var h=V(l);r=y(h,"DIV",{class:!0});var M=V(r);n=y(M,"IMG",{src:!0}),M.forEach(_),h.forEach(_),d=z(k),i=y(k,"DIV",{class:!0});var H=V(i);o=F(H,"New conversation: "),m=F(H,c),H.forEach(_),k.forEach(_),f.forEach(_),this.h()},h(){ne(n.src,a=se)||p(n,"src",a),p(r,"class","w-16 rounded-full"),p(l,"class","avatar indicator"),p(i,"class","truncate"),p(t,"class","w-full"),p(e,"class","rounded-lg w-full")},m(u,f){j(u,e,f),b(e,t),b(t,l),b(l,r),b(r,n),b(t,d),b(t,i),b(i,o),b(i,m),g||(I=[O(n,"error",s[17]),O(e,"click",s[18])],g=!0)},p(u,f){f[0]&128&&c!==(c=Z.npubEncode(u[7])+"")&&ae(m,c)},d(u){u&&_(e),g=!1,fe(I)}}}function Je(s){let e,t=s[28].unreadMessages+"",l;return{c(){e=E("span"),l=Y(t),this.h()},l(r){e=y(r,"SPAN",{class:!0});var n=V(e);l=F(n,t),n.forEach(_),this.h()},h(){p(e,"class","indicator-item badge badge-sm badge-error")},m(r,n){j(r,e,n),b(e,l)},p(r,n){n[0]&8&&t!==(t=r[28].unreadMessages+"")&&ae(l,t)},d(r){r&&_(e)}}}function Re(s){let e,t;return e=new be({props:{address:s[28].nip05VerifiedAddress,verificationMarkSize:"5"}}),{c(){x(e.$$.fragment)},l(l){ee(e.$$.fragment,l)},m(l,r){le(e,l,r),t=!0},p(l,r){const n={};r[0]&8&&(n.address=l[28].nip05VerifiedAddress),e.$set(n)},i(l){t||(D(e.$$.fragment,l),t=!0)},o(l){C(e.$$.fragment,l),t=!1},d(l){te(e,l)}}}function Qe(s){let e,t,l,r,n,a,d,i,o,c=(s[28].name??Z.npubEncode(s[27]))+"",m,g,I,u,f,k,h=s[28].unreadMessages&&Je(s),M=s[28].nip05VerifiedAddress&&Re(s);function H(){return s[20](s[27])}return{c(){e=E("li"),t=E("div"),l=E("div"),h&&h.c(),r=L(),n=E("div"),a=E("img"),i=L(),o=E("div"),m=Y(c),g=L(),M&&M.c(),I=L(),this.h()},l(T){e=y(T,"LI",{class:!0});var P=V(e);t=y(P,"DIV",{class:!0});var B=V(t);l=y(B,"DIV",{class:!0});var K=V(l);h&&h.l(K),r=z(K),n=y(K,"DIV",{class:!0});var S=V(n);a=y(S,"IMG",{src:!0}),S.forEach(_),K.forEach(_),i=z(B),o=y(B,"DIV",{class:!0});var w=V(o);m=F(w,c),g=z(w),M&&M.l(w),w.forEach(_),B.forEach(_),I=z(P),P.forEach(_),this.h()},h(){ne(a.src,d=s[28].picture??se)||p(a,"src",d),p(n,"class","w-16 rounded-full"),p(l,"class","avatar indicator"),p(o,"class","text-lg truncate"),p(t,"class","w-full"),p(e,"class","rounded-lg w-full"),R(e,"bg-primary",s[1]===s[27])},m(T,P){j(T,e,P),b(e,t),b(t,l),h&&h.m(l,null),b(l,r),b(l,n),b(n,a),b(t,i),b(t,o),b(o,m),b(o,g),M&&M.m(o,null),b(e,I),u=!0,f||(k=[O(a,"error",s[19]),O(e,"click",H)],f=!0)},p(T,P){s=T,s[28].unreadMessages?h?h.p(s,P):(h=Je(s),h.c(),h.m(l,r)):h&&(h.d(1),h=null),(!u||P[0]&8&&!ne(a.src,d=s[28].picture??se))&&p(a,"src",d),(!u||P[0]&8)&&c!==(c=(s[28].name??Z.npubEncode(s[27]))+"")&&ae(m,c),s[28].nip05VerifiedAddress?M?(M.p(s,P),P[0]&8&&D(M,1)):(M=Re(s),M.c(),D(M,1),M.m(o,null)):M&&(J(),C(M,1,1,()=>{M=null}),q()),(!u||P[0]&10)&&R(e,"bg-primary",s[1]===s[27])},i(T){u||(D(M),u=!0)},o(T){C(M),u=!1},d(T){T&&_(e),h&&h.d(),M&&M.d(),f=!1,fe(k)}}}function El(s){let e,t,l,r,n,a,d,i,o;l=new Xe({props:{$$slots:{default:[fl]},$$scope:{ctx:s}}});let c=!s[1]&&Ne(s);const m=[_l,dl],g=[];function I(u,f){return u[8]?0:1}return a=I(s),d=g[a]=m[a](s),{c(){e=L(),t=E("div"),x(l.$$.fragment),r=L(),c&&c.c(),n=L(),d.c(),i=X(),this.h()},l(u){We("svelte-gvugky",$e.head).forEach(_),e=z(u),t=y(u,"DIV",{class:!0});var k=V(t);ee(l.$$.fragment,k),k.forEach(_),r=z(u),c&&c.l(u),n=z(u),d.l(u),i=X(),this.h()},h(){$e.title="Private Messages",p(t,"class","hidden md:block")},m(u,f){j(u,e,f),j(u,t,f),le(l,t,null),j(u,r,f),c&&c.m(u,f),j(u,n,f),g[a].m(u,f),j(u,i,f),o=!0},p(u,f){const k={};f[1]&2048&&(k.$$scope={dirty:f,ctx:u}),l.$set(k),u[1]?c&&(J(),C(c,1,1,()=>{c=null}),q()):c?f[0]&2&&D(c,1):(c=Ne(u),c.c(),D(c,1),c.m(n.parentNode,n));let h=a;a=I(u),a===h?g[a].p(u,f):(J(),C(g[h],1,1,()=>{g[h]=null}),q(),d=g[a],d?d.p(u,f):(d=g[a]=m[a](u),d.c()),D(d,1),d.m(i.parentNode,i))},i(u){o||(D(l.$$.fragment,u),D(c),D(d),o=!0)},o(u){C(l.$$.fragment,u),C(c),C(d),o=!1},d(u){u&&(_(e),_(t),_(r),_(n),_(i)),te(l),c&&c.d(u),g[a].d(u)}}}async function yl(){await new Promise(t=>setTimeout(t,150));let s=document.getElementById("conversationMessagesMobile");s!==null&&(s.scrollTop=s.scrollHeight);let e=document.getElementById("conversationMessagesDesktop");e!==null&&(e.scrollTop=e.scrollHeight)}function $l(s,e,t){let l,r,n;_e(s,sl,$=>t(26,l=$)),_e(s,Ee,$=>t(2,r=$)),_e(s,rl,$=>t(8,n=$));let a=null,d,i=[],o,c,m;const g=$=>{$.key==="Enter"&&!$.shiftKey&&($.preventDefault(),I())};async function I(){const $=o.value.trim(),U=c.value.trim();let W="";if($&&$.length>0?W+=$:U&&U.length>0&&(W+=U),W.length>0){let ie;r.human[a]&&r.human[a].merchantPrivateKey&&(ie=r.human[a].merchantPrivateKey),await tl(a,W,ie,async oe=>{t(5,o.value="",o),t(6,c.value="",c),console.debug("-------- Private message accepted by relay:",oe)})}}function u($){$&&t(1,a=$)}let{onImgError:f=$=>{$.onerror="",$.src=se}}=e;el(async()=>{await ll()}),xe(async()=>{const $=l.url.searchParams.get("newMessagePubKey");$&&$.length===64&&(t(7,m=$),u($))});const k=$=>f($.srcElement),h=()=>u(m),M=$=>f($.srcElement),H=$=>u($);function T($){ke[$?"unshift":"push"](()=>{c=$,t(6,c)})}const P=$=>f($.srcElement),B=()=>u(m),K=$=>f($.srcElement),S=$=>u($),w=()=>t(1,a=null),v=$=>f($.srcElement);function A($){ke[$?"unshift":"push"](()=>{o=$,t(5,o)})}const G=()=>ye(),N=()=>ye();return s.$$set=$=>{"onImgError"in $&&t(0,f=$.onImgError)},s.$$.update=()=>{if(s.$$.dirty[0]&6)if(a&&r.human&&r.human[a]){t(4,i=Object.entries(r.human[a].messages).sort((ie,oe)=>ie[1].created_at-oe[1].created_at)),yl();const $=r.human[a].maxTimestamp;let U=localStorage.getItem("readMessages"),W=JSON.parse(U)??{};$>(W[a]??0)&&(W[a]=$,localStorage.setItem("readMessages",JSON.stringify(W)),Ee.set(r))}else t(4,i=[]);s.$$.dirty[0]&4&&(r.human?t(3,d=Object.entries(r.human).sort(($,U)=>U[1].maxTimestamp-$[1].maxTimestamp)):t(3,d=[]))},[f,a,r,d,i,o,c,m,n,g,I,u,k,h,M,H,T,P,B,K,S,w,v,A,G,N]}class Sl extends me{constructor(e){super(),pe(this,e,$l,El,he,{onImgError:0},null,[-1,-1])}}export{Sl as component};
