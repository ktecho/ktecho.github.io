import{s as J,p as v,a as R,c as Y,i as L,Y as k,d as M,y as G,o as Q,f as D,g as F,h as W,j as N,x as X,F as Z,r as C}from"./scheduler.2vmdsppc.js";import{S as $,i as ee,o as y,b as A,d as S,m as V,g as x,t as b,c as K,a as p,e as B}from"./index.eLAHt3dB.js";import{f as te,ab as oe,K as re,J as T,L as ne,e as E}from"./utils.FkBaGfnY.js";import{P as ie,a as se}from"./ProductModal.a8_RX8o4.js";import{r as le,o as ae}from"./shopping.HYDPEdxb.js";function I(a,e,r){const l=a.slice();return l[17]=e[r][0],l[18]=e[r][1],l}function ce(a){let e,r,l=E(Object.entries(a[3])),o=[];for(let i=0;i<l.length;i+=1)o[i]=j(I(a,l,i));const _=i=>b(o[i],1,1,()=>{o[i]=null});return{c(){e=D("div");for(let i=0;i<o.length;i+=1)o[i].c();this.h()},l(i){e=F(i,"DIV",{class:!0});var c=W(e);for(let t=0;t<o.length;t+=1)o[t].l(c);c.forEach(M),this.h()},h(){N(e,"class","p-0 md:p-2 py-2 pt-4 md:pt-8 h-auto grid grid-cols-2 2xl:grid-cols-3 3xl:grid-cols-4 gap-4 lg:gap-12 2xl:gap-16 3xl:gap-24 align-center mx-auto")},m(i,c){L(i,e,c);for(let t=0;t<o.length;t+=1)o[t]&&o[t].m(e,null);r=!0},p(i,c){if(c&14){l=E(Object.entries(i[3]));let t;for(t=0;t<l.length;t+=1){const u=I(i,l,t);o[t]?(o[t].p(u,c),p(o[t],1)):(o[t]=j(u),o[t].c(),p(o[t],1),o[t].m(e,null))}for(x(),t=l.length;t<o.length;t+=1)_(t);K()}},i(i){if(!r){for(let c=0;c<l.length;c+=1)p(o[c]);r=!0}},o(i){o=o.filter(Boolean);for(let c=0;c<o.length;c+=1)b(o[c]);r=!1},d(i){i&&M(e),X(o,i)}}}function ue(a){let e,r='<span class="loading loading-bars w-32"></span>';return{c(){e=D("div"),e.innerHTML=r,this.h()},l(l){e=F(l,"DIV",{class:!0,"data-svelte-h":!0}),Z(e)!=="svelte-cd86wz"&&(e.innerHTML=r),this.h()},h(){N(e,"class","flex mx-auto w-fit p-28 items-center justify-center")},m(l,o){L(l,e,o)},p:C,i:C,o:C,d(l){l&&M(e)}}}function j(a){let e,r,l,o;function _(t){a[11](t)}function i(t){a[12](t)}let c={product:a[18],onImgError:ae,isOnStall:!1};return a[1]!==void 0&&(c.viewProductIdOnModal=a[1]),a[2]!==void 0&&(c.scrollPosition=a[2]),e=new se({props:c}),v.push(()=>y(e,"viewProductIdOnModal",_)),v.push(()=>y(e,"scrollPosition",i)),{c(){A(e.$$.fragment)},l(t){S(e.$$.fragment,t)},m(t,u){V(e,t,u),o=!0},p(t,u){const f={};u&8&&(f.product=t[18]),!r&&u&2&&(r=!0,f.viewProductIdOnModal=t[1],k(()=>r=!1)),!l&&u&4&&(l=!0,f.scrollPosition=t[2],k(()=>l=!1)),e.$set(f)},i(t){o||(p(e.$$.fragment,t),o=!0)},o(t){b(e.$$.fragment,t),o=!1},d(t){B(e,t)}}}function de(a){let e,r,l,o,_,i,c;const t=[ue,ce],u=[];function f(s,m){return s[0]?1:0}e=f(a),r=u[e]=t[e](a);function h(s){a[13](s)}function g(s){a[14](s)}let P={};return a[1]!==void 0&&(P.viewProductIdOnModal=a[1]),a[2]!==void 0&&(P.scrollPosition=a[2]),o=new ie({props:P}),v.push(()=>y(o,"viewProductIdOnModal",h)),v.push(()=>y(o,"scrollPosition",g)),{c(){r.c(),l=R(),A(o.$$.fragment)},l(s){r.l(s),l=Y(s),S(o.$$.fragment,s)},m(s,m){u[e].m(s,m),L(s,l,m),V(o,s,m),c=!0},p(s,[m]){let w=e;e=f(s),e===w?u[e].p(s,m):(x(),b(u[w],1,1,()=>{u[w]=null}),K(),r=u[e],r?r.p(s,m):(r=u[e]=t[e](s),r.c()),p(r,1),r.m(l.parentNode,l));const O={};!_&&m&2&&(_=!0,O.viewProductIdOnModal=s[1],k(()=>_=!1)),!i&&m&4&&(i=!0,O.scrollPosition=s[2],k(()=>i=!1)),o.$set(O)},i(s){c||(p(r),p(o.$$.fragment,s),c=!0)},o(s){b(r),b(o.$$.fragment,s),c=!1},d(s){s&&M(l),u[e].d(s),B(o,s)}}}function fe(a,e,r){let l;G(a,te,n=>r(15,l=n));let{showOnlyProductsFromThisCommunity:o=!1}=e,{maxProductsLoaded:_=20}=e,{filter:i=null}=e,{showFixedPriceProducts:c=!0}=e,{showAuctions:t=!0}=e,u=!1,f=0,h=null,g=null,P=[];l.backend_present&&oe().then(n=>{console.log("merchantIDsFromAPI",n),n.forEach(d=>{d&&d.public_key&&P.push(d.public_key)})}).catch(n=>console.log("Error loading merchant IDs from the community:",n));let s=[],m=[];Q(async()=>{le(),re(null,null,n=>{if(!n.image&&(!n.images||n.images&&n.images.length===0))return;if(n.event.kind===T){let q=Math.floor(Date.now()/1e3),z=n.start_date+n.duration;if(q>z)return}let d=n.id;d in s?s[d].event.created_at<n.event.created_at&&r(10,s[d]=n,s):r(10,s[d]=n,s)},()=>{r(0,u=!0)})});function w(n){h=n,r(1,h)}function O(n){g=n,r(2,g)}function H(n){h=n,r(1,h)}function U(n){g=n,r(2,g)}return a.$$set=n=>{"showOnlyProductsFromThisCommunity"in n&&r(4,o=n.showOnlyProductsFromThisCommunity),"maxProductsLoaded"in n&&r(5,_=n.maxProductsLoaded),"filter"in n&&r(6,i=n.filter),"showFixedPriceProducts"in n&&r(7,c=n.showFixedPriceProducts),"showAuctions"in n&&r(8,t=n.showAuctions)},a.$$.update=()=>{a.$$.dirty&2033&&u&&(r(9,f=0),r(3,m=Object.fromEntries(Object.entries(s).sort((n,d)=>d[1].event.created_at-n[1].event.created_at).filter(([n,d])=>_>0&&f>=_||o&&!P.includes(d.event.pubkey)||i&&!(n===i||d.name?.toLowerCase().includes(i.toLowerCase())||d.description?.toLowerCase().includes(i.toLowerCase())||d.tags?.join(" ").toLowerCase().includes(i.toLowerCase()))||!t&&d.event.kind===T||!c&&d.event.kind===ne?!1:(r(9,f++,f),!0)))))},[u,h,g,m,o,_,i,c,t,f,s,w,O,H,U]}class Pe extends ${constructor(e){super(),ee(this,e,fe,de,J,{showOnlyProductsFromThisCommunity:4,maxProductsLoaded:5,filter:6,showFixedPriceProducts:7,showAuctions:8})}}export{Pe as P};
