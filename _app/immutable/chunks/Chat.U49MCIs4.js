import{s as pe,f as E,l as Y,a as G,P as fe,g as P,h as M,m as W,d as c,c as F,Q as ce,j as o,k as me,i as j,z as d,G as te,I as ve,r as he,J as Oe,y as Ge,n as le,e as ue,x as Fe,O as de,M as Q,F as Ze,a0 as Je,a1 as Qe,o as xe,T as et,b as tt,p as lt}from"./scheduler.2vmdsppc.js";import{S as ge,i as _e,a as q,g as ae,t as O,c as oe,b as se,d as ie,m as re,e as ne}from"./index.eLAHt3dB.js";import{b as Ye,e as be,E as We,a4 as ye,Z as Ie,a5 as st,P as it,a6 as rt,M as nt,q as at,a7 as ot,r as ft}from"./utils.FkBaGfnY.js";import{K as ct}from"./VerificationMark.95_-Gkx8.js";import{N as Xe}from"./Nip05Checkmark.WfrkC49G.js";import{p as we}from"./profile_picture_placeholder.0d-yZyxG.js";import{S as ut}from"./SendMessage.U2vh_8ek.js";function Ee(r,e,l){const t=r.slice();return t[10]=e[l][0],t[11]=e[l][1],t}function dt(r){let e,l;return{c(){e=fe("svg"),l=fe("path"),this.h()},l(t){e=ce(t,"svg",{xmlns:!0,fill:!0,viewBox:!0,"stroke-width":!0,stroke:!0,class:!0});var s=M(e);l=ce(s,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,d:!0}),M(l).forEach(c),s.forEach(c),this.h()},h(){o(l,"stroke-linecap","round"),o(l,"stroke-linejoin","round"),o(l,"d","M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12z"),o(e,"xmlns","http://www.w3.org/2000/svg"),o(e,"fill","none"),o(e,"viewBox","0 0 24 24"),o(e,"stroke-width","1.5"),o(e,"stroke","#6b7280"),o(e,"class","w-6 h-6")},m(t,s){j(t,e,s),d(e,l)},d(t){t&&c(e)}}}function mt(r){let e,l;return{c(){e=fe("svg"),l=fe("path"),this.h()},l(t){e=ce(t,"svg",{xmlns:!0,viewBox:!0,fill:!0,class:!0});var s=M(e);l=ce(s,"path",{d:!0}),M(l).forEach(c),s.forEach(c),this.h()},h(){o(l,"d","M11.645 20.91l-.007-.003-.022-.012a15.247 15.247 0 01-.383-.218 25.18 25.18 0 01-4.244-3.17C4.688 15.36 2.25 12.174 2.25 8.25 2.25 5.322 4.714 3 7.688 3A5.5 5.5 0 0112 5.052 5.5 5.5 0 0116.313 3c2.973 0 5.437 2.322 5.437 5.25 0 3.925-2.438 7.111-4.739 9.256a25.175 25.175 0 01-4.244 3.17 15.247 15.247 0 01-.383.219l-.022.012-.007.004-.003.001a.752.752 0 01-.704 0l-.003-.001z"),o(e,"xmlns","http://www.w3.org/2000/svg"),o(e,"viewBox","0 0 24 24"),o(e,"fill","#FF0000"),o(e,"class","w-6 h-6")},m(t,s){j(t,e,s),d(e,l)},d(t){t&&c(e)}}}function Pe(r){let e;return{c(){e=Y(r[1])},l(l){e=W(l,r[1])},m(l,t){j(l,e,t)},p(l,t){t&2&&le(e,l[1])},d(l){l&&c(e)}}}function Me(r){let e,l=be([...r[0].reactions]),t=[];for(let s=0;s<l.length;s+=1)t[s]=Te(Ee(r,l,s));return{c(){for(let s=0;s<t.length;s+=1)t[s].c();e=ue()},l(s){for(let i=0;i<t.length;i+=1)t[i].l(s);e=ue()},m(s,i){for(let n=0;n<t.length;n+=1)t[n]&&t[n].m(s,i);j(s,e,i)},p(s,i){if(i&1){l=be([...s[0].reactions]);let n;for(n=0;n<l.length;n+=1){const a=Ee(s,l,n);t[n]?t[n].p(a,i):(t[n]=Te(a),t[n].c(),t[n].m(e.parentNode,e))}for(;n<t.length;n+=1)t[n].d(1);t.length=l.length}},d(s){s&&c(e),Fe(t,s)}}}function Ve(r){let e,l=r[10]+"",t,s,i=r[11].size+"",n,a,g,_;function N(){return r[7](r[10])}return{c(){e=E("button"),t=Y(l),s=G(),n=Y(i),a=G(),this.h()},l(R){e=P(R,"BUTTON",{class:!0});var m=M(e);t=W(m,l),s=F(m),n=W(m,i),a=F(m),m.forEach(c),this.h()},h(){o(e,"class","btn btn-ghost")},m(R,m){j(R,e,m),d(e,t),d(e,s),d(e,n),d(e,a),g||(_=te(e,"click",ve(N)),g=!0)},p(R,m){r=R,m&1&&l!==(l=r[10]+"")&&le(t,l),m&1&&i!==(i=r[11].size+"")&&le(n,i)},d(R){R&&c(e),g=!1,_()}}}function Te(r){let e=["+","-"].indexOf(r[10])===-1,l,t=e&&Ve(r);return{c(){t&&t.c(),l=ue()},l(s){t&&t.l(s),l=ue()},m(s,i){t&&t.m(s,i),j(s,l,i)},p(s,i){i&1&&(e=["+","-"].indexOf(s[10])===-1),e?t?t.p(s,i):(t=Ve(s),t.c(),t.m(l.parentNode,l)):t&&(t.d(1),t=null)},d(s){s&&c(l),t&&t.d(s)}}}function De(r){let e=r[0].replies.length+"",l;return{c(){l=Y(e)},l(t){l=W(t,e)},m(t,s){j(t,l,s)},p(t,s){s&1&&e!==(e=t[0].replies.length+"")&&le(l,e)},d(t){t&&c(l)}}}function ht(r){let e,l,t,s,i,n,a,g,_,N,R;function m(u,v){return u[2]?mt:dt}let S=m(r),C=S(r),y=r[1]&&Pe(r),D=r[0].reactions&&Me(r),h=r[0].replies&&De(r);return{c(){e=E("div"),l=E("button"),C.c(),t=Y(`
         `),y&&y.c(),s=G(),D&&D.c(),i=G(),n=E("button"),a=fe("svg"),g=fe("path"),_=Y(`
         `),h&&h.c(),this.h()},l(u){e=P(u,"DIV",{class:!0});var v=M(e);l=P(v,"BUTTON",{class:!0,"data-tip":!0,style:!0});var I=M(l);C.l(I),t=W(I,`
         `),y&&y.l(I),I.forEach(c),s=F(v),D&&D.l(v),i=F(v),n=P(v,"BUTTON",{class:!0,"data-tip":!0,style:!0});var V=M(n);a=ce(V,"svg",{xmlns:!0,fill:!0,viewBox:!0,"stroke-width":!0,stroke:!0,class:!0});var K=M(a);g=ce(K,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,d:!0}),M(g).forEach(c),K.forEach(c),_=W(V,`
         `),h&&h.l(V),V.forEach(c),v.forEach(c),this.h()},h(){o(l,"class","btn btn-ghost flex tooltip tooltip-top"),o(l,"data-tip","like"),me(l,"color","#6b7280"),o(g,"stroke-linecap","round"),o(g,"stroke-linejoin","round"),o(g,"d","M7.5 8.25h9m-9 3H12m-9.75 1.51c0 1.6 1.123 2.994 2.707 3.227 1.129.166 2.27.293 3.423.379.35.026.67.21.865.501L12 21l2.755-4.133a1.14 1.14 0 01.865-.501 48.172 48.172 0 003.423-.379c1.584-.233 2.707-1.626 2.707-3.228V6.741c0-1.602-1.123-2.995-2.707-3.228A48.394 48.394 0 0012 3c-2.392 0-4.744.175-7.043.513C3.373 3.746 2.25 5.14 2.25 6.741v6.018z"),o(a,"xmlns","http://www.w3.org/2000/svg"),o(a,"fill","none"),o(a,"viewBox","0 0 24 24"),o(a,"stroke-width","1.5"),o(a,"stroke","#6b7280"),o(a,"class","w-6 h-6"),o(n,"class","btn btn-ghost flex tooltip tooltip-top"),o(n,"data-tip","reply"),me(n,"color","#6b7280"),o(e,"class","flex items-center w-full space-x-5 mb-1")},m(u,v){j(u,e,v),d(e,l),C.m(l,null),d(l,t),y&&y.m(l,null),d(e,s),D&&D.m(e,null),d(e,i),d(e,n),d(n,a),d(a,g),d(n,_),h&&h.m(n,null),N||(R=[te(l,"click",ve(r[6])),te(n,"click",ve(r[8]))],N=!0)},p(u,[v]){S!==(S=m(u))&&(C.d(1),C=S(u),C&&(C.c(),C.m(l,t))),u[1]?y?y.p(u,v):(y=Pe(u),y.c(),y.m(l,null)):y&&(y.d(1),y=null),u[0].reactions?D?D.p(u,v):(D=Me(u),D.c(),D.m(e,i)):D&&(D.d(1),D=null),u[0].replies?h?h.p(u,v):(h=De(u),h.c(),h.m(n,null)):h&&(h.d(1),h=null)},i:he,o:he,d(u){u&&c(e),C.d(),y&&y.d(),D&&D.d(),h&&h.d(),N=!1,Oe(R)}}}function pt(r,e,l){let t;Ge(r,Ye,m=>l(5,t=m));let{message:s}=e,{onReply:i=m=>{}}=e,n=0,a=!1;function g(m){t===null&&We.set("You need to either use a Nostr browser extension or register to Plebeian Market so we can provide a key for you."),i(m);const S=document.getElementById("nostrMessageSendText");S!==null&&S.focus()}const _=()=>ye(s.id,s.pubkey,"+"),N=m=>ye(s.id,s.pubkey,m),R=()=>g(s);return r.$$set=m=>{"message"in m&&l(0,s=m.message),"onReply"in m&&l(4,i=m.onReply)},r.$$.update=()=>{if(r.$$.dirty&33&&t&&s.reactions){let m=s.reactions.get("+"),S=s.reactions.get("-");m&&(l(1,n=m.size),l(2,a=m.has(t))),S&&S.size}},[s,n,a,g,i,t,_,N,R]}class gt extends ge{constructor(e){super(),_e(this,e,pt,ht,pe,{message:0,onReply:4})}}const _t="data:image/svg+xml,%3csvg%20id='Layer_1'%20data-name='Layer%201'%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20512%20512'%3e%3cdefs%3e%3cstyle%3e.cls-1{fill:%23cad8dd;}.cls-2{fill:%23dde5e8;}.cls-3{fill:%2371c6c4;}.cls-4{opacity:0.06;}.cls-5{fill:%2317292d;}%3c/style%3e%3c/defs%3e%3ctitle%3eman-1-flat%3c/title%3e%3cpath%20class='cls-1'%20d='M288,307.2H224A172.8,172.8,0,0,0,51.2,480h0a32,32,0,0,0,32,32H428.8a32,32,0,0,0,32-32h0A172.8,172.8,0,0,0,288,307.2Z'/%3e%3cpath%20class='cls-2'%20d='M256,0A128,128,0,0,0,128,128v38.4a128,128,0,0,0,64,110.87V332.8l64,38.4,64-38.4V277.27A128,128,0,0,0,384,166.4V128A128,128,0,0,0,256,0Z'/%3e%3cpath%20class='cls-3'%20d='M256,0A128,128,0,0,0,128,128v25.6l76.8-51.2S314.23,172.26,384,140.8V128A128,128,0,0,0,256,0Z'/%3e%3cg%20class='cls-4'%3e%3cpath%20class='cls-5'%20d='M256,0a127.82,127.82,0,0,0-32,4.2A127.94,127.94,0,0,1,320,128v38.4a127.94,127.94,0,0,1-96,123.8A127.55,127.55,0,0,0,384,166.4V128A128,128,0,0,0,256,0Z'/%3e%3c/g%3e%3c/svg%3e";function Re(r){let e,l,t='<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>',s,i;return{c(){e=E("div"),l=E("button"),l.innerHTML=t,this.h()},l(n){e=P(n,"DIV",{class:!0});var a=M(e);l=P(a,"BUTTON",{class:!0,"data-tip":!0,"data-svelte-h":!0}),Ze(l)!=="svelte-n6zqbi"&&(l.innerHTML=t),a.forEach(c),this.h()},h(){o(l,"class","btn btn-square btn-sm tooltip flex"),o(l,"data-tip","Close reply message"),o(e,"class","card-actions justify-end")},m(n,a){j(n,e,a),d(e,l),s||(i=te(l,"click",ve(r[5])),s=!0)},p:he,d(n){n&&c(e),s=!1,i()}}}function Ne(r){let e,l;return e=new Xe({props:{address:r[0].nip05VerifiedAddress}}),{c(){se(e.$$.fragment)},l(t){ie(e.$$.fragment,t)},m(t,s){re(e,t,s),l=!0},p(t,s){const i={};s&1&&(i.address=t[0].nip05VerifiedAddress),e.$set(i)},i(t){l||(q(e.$$.fragment,t),l=!0)},o(t){O(e.$$.fragment,t),l=!1},d(t){ne(e,t)}}}function Ae(r){let e,l,t=r[0].content.substring(0,60)+"",s,i=r[0].content.length>60&&Be();return{c(){e=E("div"),l=new Je(!1),s=ue(),i&&i.c(),this.h()},l(n){e=P(n,"DIV",{class:!0});var a=M(e);l=Qe(a,!1),s=ue(),i&&i.l(a),a.forEach(c),this.h()},h(){l.a=s,o(e,"class","mt-2 text-sm")},m(n,a){j(n,e,a),l.m(t,e),d(e,s),i&&i.m(e,null)},p(n,a){a&1&&t!==(t=n[0].content.substring(0,60)+"")&&l.p(t),n[0].content.length>60?i||(i=Be(),i.c(),i.m(e,null)):i&&(i.d(1),i=null)},d(n){n&&c(e),i&&i.d()}}}function Be(r){let e;return{c(){e=Y("...")},l(l){e=W(l,"...")},m(l,t){j(l,e,t)},d(l){l&&c(e)}}}function vt(r){let e,l,t,s,i,n,a,g,_,N,R,m,S,C,y,D,h=r[2]&&Re(r),u=r[0].nip05VerifiedAddress&&Ne(r),v=r[0].content&&Ae(r);return{c(){e=E("div"),h&&h.c(),l=G(),t=E("div"),s=E("div"),i=E("div"),n=E("img"),_=G(),N=E("div"),R=E("div"),m=E("p"),S=Y(r[3]),C=G(),u&&u.c(),y=G(),v&&v.c(),this.h()},l(I){e=P(I,"DIV",{class:!0});var V=M(e);h&&h.l(V),l=F(V),t=P(V,"DIV",{});var K=M(t);s=P(K,"DIV",{class:!0});var B=M(s);i=P(B,"DIV",{class:!0});var H=M(i);n=P(H,"IMG",{src:!0,alt:!0}),H.forEach(c),B.forEach(c),K.forEach(c),_=F(V),N=P(V,"DIV",{class:!0});var U=M(N);R=P(U,"DIV",{class:!0});var b=M(R);m=P(b,"P",{class:!0});var p=M(m);S=W(p,r[3]),p.forEach(c),C=F(b),u&&u.l(b),b.forEach(c),y=F(U),v&&v.l(U),U.forEach(c),V.forEach(c),this.h()},h(){de(n.src,a=r[4])||o(n,"src",a),o(n,"alt",g="Nostr avatar for "+r[3]),Q(n,"profileInfoImage",!r[0].samePubKey),o(i,"class","w-10 lg:w-12 ml-3 lg:mx-4 mr-0 rounded-full"),o(s,"class","chat-image avatar"),o(m,"class","mr-3 space-y-1"),o(R,"class","chat-header flex items-center"),o(N,"class","items-center w-full px-4"),o(e,"class","flex my-4")},m(I,V){j(I,e,V),h&&h.m(e,null),d(e,l),d(e,t),d(t,s),d(s,i),d(i,n),d(e,_),d(e,N),d(N,R),d(R,m),d(m,S),d(R,C),u&&u.m(R,null),d(N,y),v&&v.m(N,null),D=!0},p(I,[V]){I[2]?h?h.p(I,V):(h=Re(I),h.c(),h.m(e,l)):h&&(h.d(1),h=null),(!D||V&16&&!de(n.src,a=I[4]))&&o(n,"src",a),(!D||V&8&&g!==(g="Nostr avatar for "+I[3]))&&o(n,"alt",g),(!D||V&1)&&Q(n,"profileInfoImage",!I[0].samePubKey),(!D||V&8)&&le(S,I[3]),I[0].nip05VerifiedAddress?u?(u.p(I,V),V&1&&q(u,1)):(u=Ne(I),u.c(),q(u,1),u.m(R,null)):u&&(ae(),O(u,1,1,()=>{u=null}),oe()),I[0].content?v?v.p(I,V):(v=Ae(I),v.c(),v.m(N,null)):v&&(v.d(1),v=null)},i(I){D||(q(u),D=!0)},o(I){O(u),D=!1},d(I){I&&c(e),h&&h.d(),u&&u.d(),v&&v.d()}}}function bt(r,e,l){let t,s,{message:i}=e,{onReply:n=_=>{}}=e,{closeButton:a=!1}=e;const g=()=>n(null);return r.$$set=_=>{"message"in _&&l(0,i=_.message),"onReply"in _&&l(1,n=_.onReply),"closeButton"in _&&l(2,a=_.closeButton)},r.$$.update=()=>{r.$$.dirty&1&&l(4,t=i.profile&&i.profile.picture?i.profile.picture:_t),r.$$.dirty&1&&l(3,s=i.profile&&i.profile.name?i.profile.name:i.pubkey?i.pubkey.slice(0,8):"")},[i,n,a,s,t,g]}class $e extends ge{constructor(e){super(),_e(this,e,bt,vt,pe,{message:0,onReply:1,closeButton:2})}}function kt(r){let e,l,t,s;return{c(){e=E("div"),l=E("figure"),t=E("img"),this.h()},l(i){e=P(i,"DIV",{class:!0});var n=M(e);l=P(n,"FIGURE",{});var a=M(l);t=P(a,"IMG",{class:!0,src:!0,alt:!0}),a.forEach(c),n.forEach(c),this.h()},h(){o(t,"class","rounded-xl"),de(t.src,s=r[0])||o(t,"src",s),o(t,"alt","Embedded media"),o(e,"class","card bg-base-100 shadow-xl w-full lg:w-96")},m(i,n){j(i,e,n),d(e,l),d(l,t)},p(i,[n]){n&1&&!de(t.src,s=i[0])&&o(t,"src",s)},i:he,o:he,d(i){i&&c(e)}}}function wt(r,e,l){let{imagePreviewUrl:t}=e;return r.$$set=s=>{"imagePreviewUrl"in s&&l(0,t=s.imagePreviewUrl)},[t]}class yt extends ge{constructor(e){super(),_e(this,e,wt,kt,pe,{imagePreviewUrl:0})}}function Ke(r){let e,l,t,s;return{c(){e=E("img"),this.h()},l(i){e=P(i,"IMG",{src:!0,alt:!0}),this.h()},h(){de(e.src,l=r[4])||o(e,"src",l),o(e,"alt","avatar"),Q(e,"profileInfoImage",!r[0].samePubKey)},m(i,n){j(i,e,n),t||(s=te(e,"error",r[5]),t=!0)},p(i,n){n&16&&!de(e.src,l=i[4])&&o(e,"src",l),n&1&&Q(e,"profileInfoImage",!i[0].samePubKey)},d(i){i&&c(e),t=!1,s()}}}function Se(r){let e,l,t,s,i,n=r[0].nip05VerifiedAddress&&Ce(r);return{c(){e=E("div"),l=E("p"),t=Y(r[3]),s=G(),n&&n.c(),this.h()},l(a){e=P(a,"DIV",{class:!0});var g=M(e);l=P(g,"P",{class:!0});var _=M(l);t=W(_,r[3]),_.forEach(c),s=F(g),n&&n.l(g),g.forEach(c),this.h()},h(){o(l,"class","mr-3"),Q(l,"profileInfoName",!r[0].samePubKey),o(e,"class","chat-header flex items-center")},m(a,g){j(a,e,g),d(e,l),d(l,t),d(e,s),n&&n.m(e,null),i=!0},p(a,g){(!i||g&8)&&le(t,a[3]),(!i||g&1)&&Q(l,"profileInfoName",!a[0].samePubKey),a[0].nip05VerifiedAddress?n?(n.p(a,g),g&1&&q(n,1)):(n=Ce(a),n.c(),q(n,1),n.m(e,null)):n&&(ae(),O(n,1,1,()=>{n=null}),oe())},i(a){i||(q(n),i=!0)},o(a){O(n),i=!1},d(a){a&&c(e),n&&n.d()}}}function Ce(r){let e,l;return e=new Xe({props:{address:r[0].nip05VerifiedAddress}}),{c(){se(e.$$.fragment)},l(t){ie(e.$$.fragment,t)},m(t,s){re(e,t,s),l=!0},p(t,s){const i={};s&1&&(i.address=t[0].nip05VerifiedAddress),e.$set(i)},i(t){l||(q(e.$$.fragment,t),l=!0)},o(t){O(e.$$.fragment,t),l=!1},d(t){ne(e,t)}}}function Ue(r){let e,l,t;return l=new $e({props:{message:r[0].repliedToMessage}}),{c(){e=E("div"),se(l.$$.fragment),this.h()},l(s){e=P(s,"DIV",{class:!0});var i=M(e);ie(l.$$.fragment,i),i.forEach(c),this.h()},h(){o(e,"class","card card-compact border border-gray-400/70 my-3 shadow-xl")},m(s,i){j(s,e,i),re(l,e,null),t=!0},p(s,i){const n={};i&1&&(n.message=s[0].repliedToMessage),l.$set(n)},i(s){t||(q(l.$$.fragment,s),t=!0)},o(s){O(l.$$.fragment,s),t=!1},d(s){s&&c(e),ne(l)}}}function Le(r){let e,l;return e=new yt({props:{imagePreviewUrl:r[0].imagePreviewUrl}}),{c(){se(e.$$.fragment)},l(t){ie(e.$$.fragment,t)},m(t,s){re(e,t,s),l=!0},p(t,s){const i={};s&1&&(i.imagePreviewUrl=t[0].imagePreviewUrl),e.$set(i)},i(t){l||(q(e.$$.fragment,t),l=!0)},o(t){O(e.$$.fragment,t),l=!1},d(t){ne(e,t)}}}function It(r){let e,l,t,s,i,n,a,g,_,N=Ie(r[0].created_at)+"",R,m,S,C,y,D=r[0].content+"",h,u,v,I,V,K=!r[0].samePubKey&&Ke(r),B=!r[0].samePubKey&&Se(r),H=r[0].repliedToMessage&&Ue(r),U=r[0].imagePreviewUrl&&Le(r);return v=new gt({props:{message:r[0],onReply:r[1]}}),{c(){e=E("div"),l=E("div"),t=E("div"),s=E("div"),K&&K.c(),i=G(),n=E("div"),a=E("div"),B&&B.c(),g=G(),_=E("div"),R=Y(N),m=G(),H&&H.c(),S=G(),C=E("div"),y=new Je(!1),h=G(),U&&U.c(),u=G(),se(v.$$.fragment),this.h()},l(b){e=P(b,"DIV",{class:!0,"data-note-id":!0});var p=M(e);l=P(p,"DIV",{});var X=M(l);t=P(X,"DIV",{class:!0});var z=M(t);s=P(z,"DIV",{class:!0});var k=M(s);K&&K.l(k),k.forEach(c),z.forEach(c),X.forEach(c),i=F(p),n=P(p,"DIV",{class:!0});var T=M(n);a=P(T,"DIV",{class:!0});var L=M(a);B&&B.l(L),g=F(L),_=P(L,"DIV",{class:!0});var f=M(_);R=W(f,N),f.forEach(c),L.forEach(c),m=F(T),H&&H.l(T),S=F(T),C=P(T,"DIV",{class:!0,style:!0});var w=M(C);y=Qe(w,!1),w.forEach(c),h=F(T),U&&U.l(T),u=F(T),ie(v.$$.fragment,T),T.forEach(c),p.forEach(c),this.h()},h(){o(s,"class","w-14 ml-4 lg:mr-4 rounded-full"),o(t,"class","chat-image avatar"),o(_,"class","text-xs opacity-50"),o(a,"class","space-y-1"),y.a=null,o(C,"class","mt-2 mb-1 whitespace-pre-wrap"),me(C,"word-break","break-word"),o(n,"class","items-center w-full border-b border-gray-600 px-4"),o(e,"class","flex py-2 overflow-hidden"),o(e,"data-note-id",I=r[0].id),Q(e,"mt-0",r[0].samePubKey),Q(e,"mt-3",!r[0].samePubKey),Q(e,"profileInfo",!r[0].samePubKey)},m(b,p){j(b,e,p),d(e,l),d(l,t),d(t,s),K&&K.m(s,null),d(e,i),d(e,n),d(n,a),B&&B.m(a,null),d(a,g),d(a,_),d(_,R),d(n,m),H&&H.m(n,null),d(n,S),d(n,C),y.m(D,C),d(n,h),U&&U.m(n,null),d(n,u),re(v,n,null),V=!0},p(b,[p]){b[0].samePubKey?K&&(K.d(1),K=null):K?K.p(b,p):(K=Ke(b),K.c(),K.m(s,null)),b[0].samePubKey?B&&(ae(),O(B,1,1,()=>{B=null}),oe()):B?(B.p(b,p),p&1&&q(B,1)):(B=Se(b),B.c(),q(B,1),B.m(a,g)),(!V||p&1)&&N!==(N=Ie(b[0].created_at)+"")&&le(R,N),b[0].repliedToMessage?H?(H.p(b,p),p&1&&q(H,1)):(H=Ue(b),H.c(),q(H,1),H.m(n,S)):H&&(ae(),O(H,1,1,()=>{H=null}),oe()),(!V||p&1)&&D!==(D=b[0].content+"")&&y.p(D),b[0].imagePreviewUrl?U?(U.p(b,p),p&1&&q(U,1)):(U=Le(b),U.c(),q(U,1),U.m(n,u)):U&&(ae(),O(U,1,1,()=>{U=null}),oe());const X={};p&1&&(X.message=b[0]),p&2&&(X.onReply=b[1]),v.$set(X),(!V||p&1&&I!==(I=b[0].id))&&o(e,"data-note-id",I),(!V||p&1)&&Q(e,"mt-0",b[0].samePubKey),(!V||p&1)&&Q(e,"mt-3",!b[0].samePubKey),(!V||p&1)&&Q(e,"profileInfo",!b[0].samePubKey)},i(b){V||(q(B),q(H),q(U),q(v.$$.fragment,b),V=!0)},o(b){O(B),O(H),O(U),O(v.$$.fragment,b),V=!1},d(b){b&&c(e),K&&K.d(),B&&B.d(),H&&H.d(),U&&U.d(),ne(v)}}}function Et(r,e,l){let t,s,{message:i}=e,{onReply:n=_=>{}}=e,{onImgError:a=(_,N)=>{}}=e;const g=_=>a(_.srcElement,i);return r.$$set=_=>{"message"in _&&l(0,i=_.message),"onReply"in _&&l(1,n=_.onReply),"onImgError"in _&&l(2,a=_.onImgError)},r.$$.update=()=>{r.$$.dirty&1&&l(4,t=i.profile&&i.profile.picture?i.profile.picture:we),r.$$.dirty&1&&l(3,s=i.profile&&i.profile.name?i.profile.name:i.pubkey?i.pubkey.slice(0,8):"")},[i,n,a,s,t,g]}class Pt extends ge{constructor(e){super(),_e(this,e,Et,It,pe,{message:0,onReply:1,onImgError:2})}}function He(r,e,l){const t=r.slice();return t[30]=e[l],t}function qe(r){let e,l;return e=new Pt({props:{message:r[30],onReply:r[2],onImgError:r[3]}}),{c(){se(e.$$.fragment)},l(t){ie(e.$$.fragment,t)},m(t,s){re(e,t,s),l=!0},p(t,s){const i={};s[0]&64&&(i.message=t[30]),s[0]&4&&(i.onReply=t[2]),s[0]&8&&(i.onImgError=t[3]),e.$set(i)},i(t){l||(q(e.$$.fragment,t),l=!0)},o(t){O(e.$$.fragment,t),l=!1},d(t){ne(e,t)}}}function ze(r){let e,l,t;return l=new $e({props:{message:r[4],closeButton:!0,onReply:r[2]}}),{c(){e=E("div"),se(l.$$.fragment),this.h()},l(s){e=P(s,"DIV",{class:!0});var i=M(e);ie(l.$$.fragment,i),i.forEach(c),this.h()},h(){o(e,"class","col-span-2")},m(s,i){j(s,e,i),re(l,e,null),t=!0},p(s,i){const n={};i[0]&16&&(n.message=s[4]),i[0]&4&&(n.onReply=s[2]),l.$set(n)},i(s){t||(q(l.$$.fragment,s),t=!0)},o(s){O(l.$$.fragment,s),t=!1},d(s){s&&c(e),ne(l)}}}function Mt(r){let e,l,t,s,i="<b>Nostr</b> powered chat. Click here to see more info",n,a,g,_,N,R,m,S,C,y,D,h,u,v,I,V,K,B,H,U,b=be(r[6]),p=[];for(let k=0;k<b.length;k+=1)p[k]=qe(He(r,b,k));const X=k=>O(p[k],1,1,()=>{p[k]=null});let z=r[4]!==null&&ze(r);return K=new ut({}),{c(){e=E("div"),l=E("input"),t=G(),s=E("div"),s.innerHTML=i,n=G(),a=E("div"),g=E("p"),_=Y("Nostr channel ID: "),N=Y(r[0]),R=G(),m=E("div"),S=E("div");for(let k=0;k<p.length;k+=1)p[k].c();C=G(),y=E("div"),z&&z.c(),D=G(),h=E("div"),u=E("textarea"),v=G(),I=E("div"),V=E("div"),se(K.$$.fragment),this.h()},l(k){e=P(k,"DIV",{tabindex:!0,class:!0});var T=M(e);l=P(T,"INPUT",{type:!0}),t=F(T),s=P(T,"DIV",{class:!0,"data-svelte-h":!0}),Ze(s)!=="svelte-1y7hq7y"&&(s.innerHTML=i),n=F(T),a=P(T,"DIV",{class:!0});var L=M(a);g=P(L,"P",{class:!0});var f=M(g);_=W(f,"Nostr channel ID: "),N=W(f,r[0]),f.forEach(c),L.forEach(c),T.forEach(c),R=F(k),m=P(k,"DIV",{class:!0,style:!0,id:!0});var w=M(m);S=P(w,"DIV",{});var A=M(S);for(let ee=0;ee<p.length;ee+=1)p[ee].l(A);A.forEach(c),w.forEach(c),C=F(k),y=P(k,"DIV",{class:!0});var J=M(y);z&&z.l(J),D=F(J),h=P(J,"DIV",{class:!0});var $=M(h);u=P($,"TEXTAREA",{rows:!0,id:!0,placeholder:!0,class:!0}),M(u).forEach(c),v=F($),I=P($,"DIV",{class:!0});var x=M(I);V=P(x,"DIV",{class:!0});var Z=M(V);ie(K.$$.fragment,Z),Z.forEach(c),x.forEach(c),$.forEach(c),J.forEach(c),this.h()},h(){o(l,"type","checkbox"),o(s,"class","collapse-title text-l font-medium"),o(g,"class","mb-4"),o(a,"class","collapse-content"),o(e,"tabindex","0"),o(e,"class","collapse collapse-plus border border-gray-400/70 bg-base-100 rounded-box mb-4 lg:grid"),o(m,"class","flex flex-col mt-2 mb-6 pb-6 bg-cover bg-top bg-info-content-200 gap-2 overflow-x-hidden overflow-y-auto w-full"),me(m,"background-size","5px 5px"),me(m,"background-image","radial-gradient(hsla(var(--bc)/.2) 0.5px,hsla(var(--b2)/1) 0.5px)"),o(m,"id","chatScrollableDiv"),o(u,"rows","1"),o(u,"id","nostrMessageSendText"),u.autofocus=r[1],o(u,"placeholder","Type your message"),o(u,"class","p-2 w-full bg-medium placeholder:text-light outline-0 resize-none"),o(V,"class","w-6 h-6"),o(I,"class","p-4 flex justify-center hover:scale-110 duration-300 transition-all cursor-pointer text-white"),o(h,"class","flex col-span-2"),o(y,"class","grid grid-cols-2 w-full lg:w-1/3 mx-auto p-3 inset-x-0 bottom-0 bg-black rounded-lg items-center"),Q(y,"fixed",r[1])},m(k,T){j(k,e,T),d(e,l),d(e,t),d(e,s),d(e,n),d(e,a),d(a,g),d(g,_),d(g,N),j(k,R,T),j(k,m,T),d(m,S);for(let L=0;L<p.length;L+=1)p[L]&&p[L].m(S,null);j(k,C,T),j(k,y,T),z&&z.m(y,null),d(y,D),d(y,h),d(h,u),r[11](u),d(h,v),d(h,I),d(I,V),re(K,V,null),B=!0,r[1]&&u.focus(),H||(U=[te(u,"keypress",r[7]),te(I,"click",r[8]),te(I,"keypress",r[7])],H=!0)},p(k,T){if((!B||T[0]&1)&&le(N,k[0]),T[0]&76){b=be(k[6]);let L;for(L=0;L<b.length;L+=1){const f=He(k,b,L);p[L]?(p[L].p(f,T),q(p[L],1)):(p[L]=qe(f),p[L].c(),q(p[L],1),p[L].m(S,null))}for(ae(),L=b.length;L<p.length;L+=1)X(L);oe()}k[4]!==null?z?(z.p(k,T),T[0]&16&&q(z,1)):(z=ze(k),z.c(),q(z,1),z.m(y,D)):z&&(ae(),O(z,1,1,()=>{z=null}),oe()),(!B||T[0]&2)&&(u.autofocus=k[1]),(!B||T[0]&2)&&Q(y,"fixed",k[1])},i(k){if(!B){for(let T=0;T<b.length;T+=1)q(p[T]);q(z),q(K.$$.fragment,k),B=!0}},o(k){p=p.filter(Boolean);for(let T=0;T<p.length;T+=1)O(p[T]);O(z),O(K.$$.fragment,k),B=!1},d(k){k&&(c(e),c(R),c(m),c(C),c(y)),Fe(p,k),z&&z.d(),r[11](null),ne(K),H=!1,Oe(U)}}}const Vt=!0,je=100,Tt=1500,Dt=3e3;function Rt(r,e){for(const l of r)if(l.id===e)return l}function Nt(r,e,l){let t;Ge(r,Ye,f=>l(16,t=f));let{nostrRoomId:s}=e,{messageLimit:i=60}=e,{messagesSince:n=1672837281}=e,{isMarketSquare:a=!1}=e,{onReply:g=f=>{l(4,_=f)}}=e,_=null,N,R=[],m=[],S=!0,C=!1,y=null,D=null,h=new Map,u=new Map,v=new Map,{onImgError:I=(f,w)=>{f.onerror="",f.src=we;let A=h.get(w.pubkey);A&&A!==null&&A!==!0&&(A.picture=we)}}=e;function V(){let f=null;l(6,m=R.sort((w,A)=>w.created_at>=A.created_at?1:-1).map(function(w){f===w.pubkey&&(w.samePubKey=!0);const A=h.get(w.pubkey)||null;if(A!==null&&A!==!0){if(A.picture&&Vt&&(A.picture=`https://media.nostr.band/thumbs/${w.pubkey.slice(-4)}/${w.pubkey}-picture-64`),A.nip05){let x=u.get(A.nip05);if(x===void 0)u.set(A.nip05,null);else if(x!==null&&w.pubkey===x){let Z=A.nip05;Z.startsWith("_@")?w.nip05VerifiedAddress=Z.substring(2):w.nip05VerifiedAddress=Z}}w.profile=A}nt(w.tags,"e").forEach(x=>{const Z=x[1];if(Z!==s){let ee=Rt(R,Z);if(ee!==void 0){let ke=ee.replies||[];ke.includes(w.id)||ke.push(w.id),ee.replies=ke,w.repliedToMessage=ee}else w.repliedToMessage=Z}});const J=w.content.match(/(https?:\/\/.*\.(?:png|jpg|jpeg|gif|svg))/i),$=J?J[1]:null;return $!==null&&(w.imagePreviewUrl=$),f=w.pubkey,w}))}function K(f){h.has(f)||h.set(f,null)}function B(f){v.has(f)||v.set(f,null)}function H(){let f=[],w=0;for(const[A,J]of h)if(J===null&&(h.set(A,!0),f.push(A),w++,w==je))break;f.length!==0&&at(f,(A,J)=>{h.set(A,J)})}function U(){let f=[],w=0;for(const[A,J]of v)if(J===null&&(v.set(A,!0),f.push(A),w++,w==je))break;f.length!==0&&ot(f,A=>{if(A.kind===ct.Reaction){const J=A.tags.reverse().find(Z=>Z[0]==="e")?.[1];if(!J)return;const $=A.content,x=A.pubkey;for(const Z of R)if(Z.id===J){Z.reactions===void 0&&(Z.reactions=new Map),Z.reactions.get($)===void 0&&Z.reactions.set($,new Set),Z.reactions.get($).add(x);break}}})}function b(){u.forEach(async(f,w)=>{if(f===null){u.set(w,!0);let A=await ft(w);u.set(w,A)}})}function p(){V(),y=setTimeout(p,Tt)}function X(){H(),U(),b(),D=setTimeout(X,Dt)}xe(async()=>{st(s,i,n,f=>{for(const w of R)if(w.id===f.id)return;R.push(f),K(f.pubkey),B(f.id)}),p(),X(),window.addEventListener("scroll",function(){if(C){C=!1;return}S=!1})}),et(async()=>{y!==null&&clearTimeout(y),D!==null&&clearTimeout(D)});const z=f=>{f.key==="Enter"&&!f.shiftKey&&(f.preventDefault(),k())};async function k(){if(!await it())return;const f=N.value.trim();t===null?We.set("You need to use a Nostr browser extension to be able to send messages to the chat."):f&&rt(f,s,_,null,()=>{l(4,_=null),l(5,N.value="",N),T()})}const T=()=>{if(C=!0,a)window.scrollTo(0,document.body.scrollHeight);else{const f=document.getElementById("chatScrollableDiv");f!==null&&(f.scrollTop=f.scrollHeight);const w=document.getElementById("stallChatContainerDiv");w!==null&&(w.scrollTop=w.scrollHeight)}};tt(()=>{S&&a&&T()});function L(f){lt[f?"unshift":"push"](()=>{N=f,l(5,N)})}return r.$$set=f=>{"nostrRoomId"in f&&l(0,s=f.nostrRoomId),"messageLimit"in f&&l(9,i=f.messageLimit),"messagesSince"in f&&l(10,n=f.messagesSince),"isMarketSquare"in f&&l(1,a=f.isMarketSquare),"onReply"in f&&l(2,g=f.onReply),"onImgError"in f&&l(3,I=f.onImgError)},[s,a,g,I,_,N,m,z,k,i,n,L]}class Ht extends ge{constructor(e){super(),_e(this,e,Nt,Mt,pe,{nostrRoomId:0,messageLimit:9,messagesSince:10,isMarketSquare:1,onReply:2,onImgError:3},null,[-1,-1])}}export{Ht as C};
